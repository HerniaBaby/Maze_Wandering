# Maze Wandering (迷路探索プログラム)

## プログラム概要
このプログラムは、迷路探索をシミュレーションするMATLABコードです。プレイヤーは迷路内を移動し、ゴール地点を目指します。迷路の生成、プレイヤーの視野、レイキャスティング、および一人称視点の描画を含む機能が実装されています。

---

## 設定可能なパラメータ

### 迷路のパラメータ
- **passageWidth**: 通路の幅（単位: ピクセル）。
  - デフォルト値: `8`
- **wallThickness**: 壁の厚さ（単位: ピクセル）。
  - デフォルト値: `5`
- **sz_map**: 迷路のサイズ（行列形式 [行, 列]）。
  - デフォルト値: `[20 10]`

### プレイヤーの設定
- **player.pos**: プレイヤーの初期位置。
  - デフォルト値: 迷路内の最小の空きスペース座標。
- **player.angle**: プレイヤーの初期視線角度（度単位）。
  - デフォルト値: `90`
- **Angle**: プレイヤーの視野角（度単位）。
  - デフォルト値: `60`
- **dAngle**: 回転時の角度増分（度単位）。
  - デフォルト値: `5`
- **r**: レイキャスティングの半径（単位: ピクセル）。
  - デフォルト値: `15`
- **view_range_ini**: 初期の視野範囲（単位: ピクセル）。
  - デフォルト値: `100`
- **view_range**: 現在の視野範囲（単位: ピクセル）。
  - デフォルト値: `view_range_ini`

### レイキャスティングの設定
- **n**: レイの本数。
  - デフォルト値: `51`
- **K**: 一人称視点での壁の高さゲイン。
  - デフォルト値: `3`

---

## 実装の詳細

### 迷路生成
迷路は `mapMaze` 関数を使用して生成されます。生成された迷路は `occupancyMatrix` を使って占有マトリックスに変換されます。ゴール地点は迷路の右下に配置され、ゴールラインが設定されます。

### プレイヤーの視野
プレイヤーは視野角 `Angle` とレイキャスティングの半径 `r` に基づいて視野を計算します。視野は極座標で計算され、視野内の各レイが壁に当たる位置を計算します。

### レイキャスティング
`polyxpoly` 関数を使用して、プレイヤーの視野内で壁との交点を計算します。交点から壁までの距離を正規化し、一人称視点で壁の高さを調整します。

### 描画
- **Bird's-eye view (俯瞰図)**: プレイヤーの位置と視野を迷路全体とともに表示します。
- **FPS view (一人称視点)**: レイキャスティング結果をもとに壁を描画します。

---

## 操作方法

### キーボード操作
- **回転**:
  - `e`: 時計回りに90度回転
  - `r`: 反時計回りに90度回転
  - `t`: 視線方向をリセット
- **ズーム**:
  - `w`: ズームイン
  - `q`: ズームアウト
  - `z`: ズームをリセット
- **視野範囲**:
  - `v`: 視野範囲を狭める
  - `c`: 視野範囲を広げる
  - `x`: 視野範囲をリセット
- **移動**:
  - 矢印キー: 上下左右に移動

### マウス操作
- クリック & ドラッグでプレイヤーの位置を変更可能。

---

## 注意事項
- ゴール地点に到達するとメッセージボックスが表示され、プログラムが終了します。
- 壁との衝突は自動的に回避され、プレイヤーは壁を通過できません。

---

## コードの構造
コードは以下のセクションで構成されています:
1. パラメータ設定
2. 迷路生成
3. プレイヤーの初期化
4. レイキャスティング
5. 描画
6. プレイヤー操作
7. 衝突検知
